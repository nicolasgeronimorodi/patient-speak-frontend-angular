<div class="card">
    <p-table #dt [value]="entities" [columns]="cols" [lazy]="true" [paginator]="true" [rows]="facadeService.lazyLoadEvent.rows!" [filters]="cleanedFilters" [lazy]="true" (onLazyLoad)="facadeService.search($event)" [loading]="isLoading" [paginator]="true"
        [rowsPerPageOptions]="[6, 12, 24]" [totalRecords]="totalItems" [first]="facadeService.lazyLoadEvent.first!" [rowHover]="true" responsiveLayout="scroll" dataKey="id">
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th *ngFor="let col of cols" [ngSwitch]="col.field">
                    {{col.header}}

                    <p-columnFilter *ngSwitchCase="'tagName'" field="tagName" matchMode="equals" display="menu" [showOperator]="false" [showAddButton]="false" [showMatchModes]="false" [hideOnClear]="true">
                        <ng-template #filter let-value let-filter="filterCallback">
                            <ng-container *ngIf="tags.length > 0">
                                <!-- <p-dropdown class="w-full" optionLabel="name" optionValue="id" [options]="tags" [(ngModel)]="value" placeholder="Seleccionar categoría" (onChange)="filter($event.value)" /> -->
                                <p-select [ngModel]="value" [options]="tags" (ngModelChange)="filter($event.value)" placeholder="Select One" styleClass="w-full">
                                    <ng-template let-option #item>
                                        <p-tag [value]="option.value"></p-tag>
                                    </ng-template>
                                </p-select>
                            </ng-container>
                        </ng-template>
                    </p-columnFilter>

                    <p-columnFilter *ngSwitchCase="'createdAt'" type="date" matchMode="between" [field]="col.field" display="menu" [showOperator]="false" [showAddButton]="false" [showMatchModes]="false" [hideOnClear]="true">
                        <ng-template #filter let-value let-filter="filterCallback">
                            <div class="flex flex-col gap-2 p-2">
                                <p-calendar selectionMode="range" [readonlyInput]="true" [showIcon]="true" [ngModel]="value" (ngModelChange)="filter($event)" dateFormat="dd/mm/yy" inputId="range" placeholder="Desde - Hasta" class="w-full" />
                            </div>
                        </ng-template>
                    </p-columnFilter>
                </th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-entity let-columns>
            <tr *ngIf="!isLoading;">
                <td *ngFor="let col of cols" [ngSwitch]="col.field">
                    <div *ngSwitchDefault>{{entity[col.field] ?? "-" }}</div>
                    <div *ngSwitchCase="'content'"> {{truncate(entity.content, 80)}}</div>
                    <div *ngSwitchCase="'actions'">
                        <div class="flex items-center gap-2 whitespace-nowrap">
                            <!-- Ver detalle -->
                            <button pButton pRipple type="button" icon="pi pi-eye" class="p-button-rounded p-button-text p-button-plain text-gray-700 dark:text-gray-300 hover:bg-blue-600 dark:hover:bg-blue-400" (click)="navigateToTranscriptionDetail(entity.id!)" pTooltip="Ver detalle"
                                tooltipPosition="top"></button>
                            <!-- Desactivar -->
                            <button pButton pRipple type="button" icon="pi pi-ban" class="p-button-rounded p-button-text p-button-plain text-gray-700 dark:text-gray-300 hover:bg-red-600 dark:hover:bg-red-400" (click)="onDeactivateTranscription(entity.id!)" pTooltip="Desactivar transcripción"
                                tooltipPosition="top"></button>
                        </div>
                    </div>
                </td>
            </tr>

        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="5">No hay transcripciones visibles.</td>
            </tr>
        </ng-template>
    </p-table>
</div>