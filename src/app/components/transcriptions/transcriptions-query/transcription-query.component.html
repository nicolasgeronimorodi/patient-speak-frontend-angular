<div class="mb-4 flex justify-between items-center">
    <div class="flex gap-2">
        <button pButton [label]="'Tarjetas'" icon="pi pi-th-large" [class.p-button-outlined]="viewMode !== 'card'" (click)="setViewMode('card')"></button>
        <button pButton [label]="'Grilla'" icon="pi pi-table" [class.p-button-outlined]="viewMode !== 'grid'" (click)="setViewMode('grid')"></button>
    </div>
    <input pInputText [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange($event)" placeholder="Buscar por motivo de consulta o contenido..." class="w-full md:w-[60%] text-sm" />
</div>

<!-- Filtros -->
<div class="mb-4 flex flex-wrap items-center gap-3">
    <p-dropdown
        [options]="tagOptions"
        [(ngModel)]="selectedTagId"
        (onChange)="onTagFilterChange()"
        optionLabel="label"
        optionValue="value"
        placeholder="Categoría"
        [showClear]="selectedTagId !== null"
        class="text-sm">
    </p-dropdown>

    <p-autoComplete
        [(ngModel)]="selectedPatient"
        [suggestions]="patientSuggestions"
        (completeMethod)="searchPatients($event)"
        (onSelect)="onPatientSelect($event)"
        (onClear)="onPatientClear()"
        field="fullName"
        placeholder="Buscar paciente..."
        [minLength]="2"
        [dropdown]="false"
        class="text-sm">
    </p-autoComplete>

    <p-datepicker
        [(ngModel)]="dateFrom"
        (onSelect)="onDateFilterChange()"
        [maxDate]="dateTo || undefined"
        dateFormat="dd/mm/yy"
        placeholder="Fecha desde"
        [showIcon]="true"
        appendTo="body"
        class="text-sm">
    </p-datepicker>

    <p-datepicker
        [(ngModel)]="dateTo"
        (onSelect)="onDateFilterChange()"
        [minDate]="dateFrom || undefined"
        dateFormat="dd/mm/yy"
        placeholder="Fecha hasta"
        [showIcon]="true"
        appendTo="body"
        class="text-sm">
    </p-datepicker>

    <button
        *ngIf="hasActiveFilters"
        pButton
        type="button"
        icon="pi pi-filter-slash"
        label="Limpiar filtros"
        class="p-button-outlined p-button-sm"
        (click)="clearFilters()">
    </button>

    <button
        pButton
        type="button"
        icon="pi pi-info-circle"
        class="p-button-rounded p-button-text p-button-sm"
        (click)="dateFilterInfo.toggle($event)">
    </button>

    <p-popover #dateFilterInfo>
        <div class="max-w-xs text-sm text-text-secondary dark:text-text-secondary-dark">
            <p class="font-semibold mb-1">Filtros de fecha</p>
            <p>Los filtros de fecha son inclusivos. "Fecha desde" incluye desde el inicio
            del día seleccionado y "Fecha hasta" incluye hasta el final del día seleccionado.</p>
        </div>
    </p-popover>
</div>

<app-transcriptions-query-grid-view *ngIf="viewMode === 'grid'" [transcriptions]="transcriptions" [isLoading]="isLoading" [totalItems$]="totalItems$" [currentPage]="currentPage" [pageSize]="pageSize" (pageChange)="onPageChange($event)" (navigateToDetail)="navigateToTranscriptionDetail($event)"
    (delete)="onDeleteTranscription($event)"></app-transcriptions-query-grid-view>

<app-transcriptions-query-card-view *ngIf="viewMode === 'card'" [transcriptions]="transcriptions" [isLoading]="isLoading" [totalItems$]="totalItems$" [currentPage]="currentPage" [pageSize]="pageSize" (pageChange)="onPageChange($event)" (navigateToDetail)="navigateToTranscriptionDetail($event)"
    (delete)="onDeleteTranscription($event)"></app-transcriptions-query-card-view>
